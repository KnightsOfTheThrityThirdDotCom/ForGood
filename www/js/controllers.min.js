var serviceUrl="http://for-good.be/system/nl/service/",sha=null;if(window.localStorage.user){var user=JSON.parse(window.localStorage.user);sha="/sha="+user.sha}angular.module("forgood.controllers",[]).controller("MainCtrl",function(e,t,a,o,n,r,n){r.ready(function(){function e(){n.show({title:"Geen netwerk verbinding",template:"De app kan geen verbinding maken met het internet.",buttons:[{text:"sluiten",type:"bgGreen"}]})}document.addEventListener("offline",e,!1)}),e.openPopup=function(e,t){console.log(e,t),n.show({title:e,template:t,buttons:[{text:"sluiten",type:"bgGreen"}]})},e.closePopup=function(){popUp[0].classList.add("hidden")}}).controller("LogoutCtrl",function(e,t,a,o){o.nextViewOptions({disableBack:!0}),window.localStorage.clear(),a.go("login")}).controller("LoginCtrl",function(e,t,a,o,n,r){"undefined"!=typeof analytics&&analytics.trackView("Login"),e.formData,e.processForm=function(){n.show({template:"Aanmelden..."}),t({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"login",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){if(o.nextViewOptions({disableBack:!0}),1===e.success){n.hide(),sha="/sha="+e.user.sha;var t=JSON.stringify(e.user);window.localStorage.user=t,a.go(1===e.user.nulmeting?"progress":"account-mobility")}else n.hide(),alert("Gelieve in te loggen met de juiste gegevens.")})}}).controller("CreateAccountCtrl",function(e,t,a,o,n,r){"undefined"!=typeof analytics&&analytics.trackView("Create Account"),e.formData,e.processForm=function(){e.formData.password!==e.formData.passwordCheck?n.show({title:"Wachtwoord validatie onjuist",template:"U heeft twee keer een ander wachtwoord ingevuld. Gelieve twee keer hetzelfde wachtwoord in te vullen.",buttons:[{text:"Sluiten",type:"bgGreen"}]}):(r.show({template:"Account aanmaken..."}),t({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"createProfile",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){if(o.nextViewOptions({disableBack:!0}),1===e.success){sha="/sha="+e.user.sha;var t=JSON.stringify(e.user);console.log(e.user.sha),window.localStorage.user=t,a.go("account-mobility")}else r.hide(),alert("Gelieve een juist email adres op te geven en een wachtwoord met minstens vier karakters.")}))}}).controller("ForgotPasswordCtrl",function(e,t,a,o,n){"undefined"!=typeof analytics&&analytics.trackView("Forgot Password"),e.formData,e.processForm=function(){n.show({template:"Wachtwoord opvragen..."}),t({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"forgotPassword"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){o.nextViewOptions({disableBack:!0}),1===e.success?(console.log(e),a.go("login")):(n.hide(),alert("Van dit e-mail adres bestaan geen gegevens."))})}}).controller("MobilityCtrl",function(e,t,a,o,n,r){if(e.formData={},e.formData.fuelType="0",e.formData.averageConsumption="0",e.formData.unitType="1",e.hasCar="true",window.localStorage.mobilityBackup){var i=JSON.parse(window.localStorage.mobilityBackup);e.formData=i}"undefined"!=typeof analytics&&analytics.trackView("Initial Mobility input"),e.processForm=function(){r.show({template:"Gegevens versturen..."}),a({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateMobilityProfile"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){n.nextViewOptions({disableBack:!0}),o.go("account-energy")})},t.$on("$stateChangeStart",function(t,a,o,n,r){var i=JSON.stringify(e.formData);window.localStorage.mobilityBackup=i})}).controller("EnergyCtrl",function(e,t,a,o,n,r){if("undefined"!=typeof analytics&&analytics.trackView("Initial Energy input"),e.formData={},e.formData={electricityType:"2",yearlyConsumptionHeatingUnit:"2",fuelTypeHeating:"0",userKnowsEnergy:"true",typeMeter:"double"},window.localStorage.energyBackup){var i=JSON.parse(window.localStorage.energyBackup);e.formData=i}e.processForm=function(){r.show({template:"Gegevens versturen..."}),a({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateEnergyProfile"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){n.nextViewOptions({disableBack:!0}),o.go("account-monitor")})},t.$on("$stateChangeStart",function(t,a,o,n,r){var i=JSON.stringify(e.formData);window.localStorage.energyBackup=i})}).controller("MonitorCtrl",function(e,t,a,o,n,r){if("undefined"!=typeof analytics&&analytics.trackView("Initial Monitoring input"),e.formData={},window.localStorage.monitorBackup){var i=JSON.parse(window.localStorage.monitorBackup);e.formData=i}e.processForm=function(){r.show({template:"Gegevens versturen..."}),a({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateService"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){n.nextViewOptions({disableBack:!0});var t=JSON.parse(window.localStorage.user);t.nulmeting=1,window.localStorage.user=JSON.stringify(t),o.go("progress")})},t.$on("$stateChangeStart",function(t,a,o,n,r){var i=JSON.stringify(e.formData);window.localStorage.monitorBackup=i})}).controller("ProgressCtrl",function(e,t,a,o,n,r,i,l,c,s,u,d,p){function m(){if(navigator.network.connection.type==Connection.NONE){var a=JSON.parse(window.localStorage.userData),o=JSON.parse(window.localStorage.tips);e.dataTotal=a,e.tips=o,e.loadCharts(),e.$apply()}else t.loadUserData(),t.loadTips()}"undefined"!=typeof analytics&&analytics.trackView("Main Progress overview"),(window.localStorage.mobilityBackup||window.localStorage.energyBackup||window.localStorage.monitorBackup)&&(window.localStorage.removeItem("mobilityBackup"),window.localStorage.removeItem("energyBackup"),window.localStorage.removeItem("monitorBackup")),e.loadCharts=function(){e.chartData={chartTotal:[{value:e.dataTotal.TOTAL.circle.mobility_100,color:"#46acf1"},{value:e.dataTotal.TOTAL.circle.energy_100,color:"#eecc30"},{value:e.dataTotal.TOTAL.circle.consumption_100,color:"#f7395e"},{value:0,color:"#000"}],chartMobility:[{value:e.dataTotal.MOBILITY.circle.car_100,color:"#235679"},{value:e.dataTotal.MOBILITY.circle.public_100,color:"#388ac1"},{value:e.dataTotal.MOBILITY.circle.plane_100,color:"#46acf1"}],chartEnergy:[{value:e.dataTotal.ENERGY.circle.elec_100,color:"#776618"},{value:e.dataTotal.ENERGY.circle.heat_100,color:"#bea326"}],chartConsumption:[{value:e.dataTotal.CONSUMPTION.circle.package_100,color:"#f7395e"},{value:e.dataTotal.CONSUMPTION.circle.transport_100,color:"#fb9cae"},{value:e.dataTotal.CONSUMPTION.circle.storage_100,color:"#c62e4b"},{value:e.dataTotal.CONSUMPTION.circle.season_100,color:"#fdd7df"},{value:e.dataTotal.CONSUMPTION.circle.ingredients_100,color:"#7c1d2f"}]};var t=document.getElementById("chart-total").getContext("2d"),a=document.getElementById("chart-mobility").getContext("2d"),o=document.getElementById("chart-energy").getContext("2d"),n=document.getElementById("chart-consumption").getContext("2d"),r={animation:!1,segmentStrokeWidth:1,percentageInnerCutout:65,segmentStrokeColor:"#f3efe7"};e.chartTotal=new Chart(t).Doughnut(e.chartData.chartTotal,r),e.chartMobility=new Chart(a).Doughnut(e.chartData.chartMobility,r),e.chartEnergy=new Chart(o).Doughnut(e.chartData.chartEnergy,r),e.chartConsumption=new Chart(n).Doughnut(e.chartData.chartConsumption,r)},e.reloadCharts=function(){e.chartData={chartTotal:[{value:e.dataTotal.TOTAL.circle.mobility_100,color:"#46acf1"},{value:e.dataTotal.TOTAL.circle.energy_100,color:"#eecc30"},{value:e.dataTotal.TOTAL.circle.consumption_100,color:"#f7395e"},{value:0,color:"#000"}],chartMobility:[{value:e.dataTotal.MOBILITY.circle.car_100,color:"#235679"},{value:e.dataTotal.MOBILITY.circle.public_100,color:"#388ac1"},{value:e.dataTotal.MOBILITY.circle.plane_100,color:"#46acf1"}],chartEnergy:[{value:e.dataTotal.ENERGY.circle.elec_100,color:"#776618"},{value:e.dataTotal.ENERGY.circle.heat_100,color:"#bea326"}],chartConsumption:[{value:e.dataTotal.CONSUMPTION.circle.package_100,color:"#f7395e"},{value:e.dataTotal.CONSUMPTION.circle.transport_100,color:"#fb9cae"},{value:e.dataTotal.CONSUMPTION.circle.storage_100,color:"#c62e4b"},{value:e.dataTotal.CONSUMPTION.circle.season_100,color:"#fdd7df"},{value:e.dataTotal.CONSUMPTION.circle.ingredients_100,color:"#7c1d2f"}]};for(var t=0;t<e.chartTotal.segments.length;t++)e.chartTotal.segments[t].value=e.chartData.chartTotal[t].value,e.chartTotal.update();for(var t=0;t<e.chartMobility.segments.length;t++)e.chartMobility.segments[t].value=e.chartData.chartMobility[t].value,e.chartMobility.update();for(var t=0;t<e.chartEnergy.segments.length;t++)e.chartEnergy.segments[t].value=e.chartData.chartEnergy[t].value,e.chartEnergy.update();for(var t=0;t<e.chartConsumption.segments.length;t++)e.chartConsumption.segments[t].value=e.chartData.chartConsumption[t].value,e.chartConsumption.update()},t.loadUserData=function(){o({method:"POST",crossDomain:!0,url:serviceUrl+"stats"+sha}).success(function(t){console.log(t),e.totalFootprint=t.footprint_total,e.scale=t.SCALE,e.dataTotal=t,window.localStorage.userData=JSON.stringify(t),e.loadCharts(),e.$broadcast("scroll.refreshComplete")})},t.reloadUserData=function(){o({method:"POST",crossDomain:!0,url:serviceUrl+"stats"+sha}).success(function(t){e.dataTotal=t,window.localStorage.userData=JSON.stringify(t),e.reloadCharts(),e.$broadcast("scroll.refreshComplete")})},t.loadTips=function(){o({method:"POST",crossDomain:!0,url:serviceUrl+"getTips"+sha}).success(function(t){console.log(t),e.tips=t,window.localStorage.tips=JSON.stringify(t)})},document.addEventListener("deviceready",m,!1),window.localStorage.desktop&&(t.loadUserData(),t.loadTips());var g=document.getElementById("swipe-position").getElementsByTagName("span"),f=document.getElementById("graphs").getElementsByClassName("cats");window.mySwipe=Swipe(document.getElementById("swipe"),{continuous:!1,callback:function(t){for(var a=g.length;a--;)g[a].className="off",f[a].classList.remove("on");g[t].className="on",f[t].classList.add("on"),e.hideSub=!0},transitionEnd:function(){s.$getByHandle("scroll").scrollTop()}}),e.goToSlide=function(e){window.mySwipe.slide(e)},e.scan=function(){cordova.plugins.barcodeScanner.scan(function(a){if(console.log(a),!a.cancelled){var l={ean:a.text};p.show({template:"Product ophalen..."}),o({method:"POST",crossDomain:!0,data:$.param(l),url:serviceUrl+"getProduct"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a){p.hide(),1===a.success?(i.submit(a),n.go("product")):(t.missingEan=l.ean,r.show({title:"Geen product gevonden",template:"Helaas, dit product zit nog niet in ons systeem. Stuur ons een foto van het product en we zorgen dat deze zo snel mogelijk is ons systeem wordt toegevoegd.",buttons:[{text:"Neem foto",type:"bgBlue f-s-small",onTap:function(t){e.eanModal.show()}},{text:"Nieuwe scan",type:"bgGreen f-s-small",onTap:function(t){e.scan()}},{text:"Sluit",type:"bgRed f-s-small"}]}))})}},function(e){})},e.currentGraph="period",e.changeGraph=function(){o({method:"POST",crossDomain:!0,url:serviceUrl+"stats"+sha+"/"+this.currentGraph}).success(function(t){e.scale=t.SCALE,e.dataTotal.TOTAL.graph_final=t.TOTAL.graph_final,e.dataTotal.ENERGY.graph_final=t.ENERGY.graph_final,e.dataTotal.MOBILITY.graph_final=t.MOBILITY.graph_final,e.dataTotal.CONSUMPTION.graph_final=t.CONSUMPTION.graph_final})},e.ignoreTip=function(t,a){console.log(a);var n={tipID:t,kind:a};o({method:"POST",crossDomain:!0,data:$.param(n),url:serviceUrl+"ignoreTip"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a){console.log(a),1===a.success&&(c.remove(e.tips,t,a.tip),s.$getByHandle("scroll").resize())})},u.fromTemplateUrl("templates/bill.html",function(t){e.billModal=t},{scope:e,animation:"slide-in-up"}),u.fromTemplateUrl("templates/update-mobility.html",function(t){e.updateMobilityModal=t},{scope:e,focusFirstInput:!1,animation:"slide-in-up"}),u.fromTemplateUrl("templates/update-energy.html",function(t){e.updateEnergyModal=t},{scope:e,focusFirstInput:!1,animation:"slide-in-up"}),u.fromTemplateUrl("templates/settings.html",function(t){e.settingsModal=t},{scope:e,animation:"slide-in-up"}),u.fromTemplateUrl("templates/ean.html",function(t){e.eanModal=t},{scope:e,animation:"slide-in-up"}),e.openResetPopup=function(){r.show({title:"Account resetten",template:"Weet je zeker dat je jouw account wil resetten? Alle gegevens van mobiliteit, wonen en consumptie zullen gewist worden.",buttons:[{text:"Resetten",type:"bgOrange",onTap:function(t){o({method:"POST",crossDomain:!0,url:serviceUrl+"resetAccount"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(t){if(d.nextViewOptions({disableBack:!0}),1===t.success){var a=JSON.stringify(t.user);window.localStorage.user=a,e.settingsModal.hide(),n.go("account-mobility")}})}},{text:"Annuleren",type:"bgGreen"}]})},e.logout=function(){e.settingsModal.hide().then(function(){window.localStorage.clear(),n.go("logout")})},e.hideSub=!0,e.toggleSub=function(){e.hideSub=e.hideSub===!1?!0:!1},e.closeSub=function(){e.hideSub=!0}}).controller("UpdateMobilityCtrl",function(e,t,a,o){"undefined"!=typeof analytics&&analytics.trackView("Updating Mobility monitoring"),e.init=function(){a({method:"POST",crossDomain:!0,data:e.formData,url:serviceUrl+"getProfile"+sha}).success(function(t){e.currentValue=t.user})},e.init(),e.formData={},e.processForm=function(n){o.show({template:"Gegevens versturen..."}),a({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateMobilityService"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a){o.hide(),t.loadUserData(),e.updateMobilityModal.hide()})}}).controller("UpdateEnergyCtrl",function(e,t,a,o){"undefined"!=typeof analytics&&analytics.trackView("Updating Energy monitoring"),e.init=function(){a({method:"POST",crossDomain:!0,data:e.formData,url:serviceUrl+"getProfile"+sha}).success(function(t){e.currentValue=t.user})},e.init(),e.formData={},e.processForm=function(){o.show({template:"Gegevens versturen..."}),a({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateEnergyService"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a){o.hide(),t.loadUserData(),e.updateEnergyModal.hide()})}}).controller("ProductCtrl",function(e,t,a,o,n,r){"undefined"!=typeof analytics&&analytics.trackView("Product view"),e.init=function(){e.product=n.get(),console.log(e.product)},e.init()}).controller("BillCtrl",function(e,t,a,o,n,r,i,l){function c(t){setTimeout(function(){e.pictures.push(t),e.$apply()},10)}function s(e){}"undefined"!=typeof analytics&&analytics.trackView("Add Bill view"),e.pictures=[],e.captureImg=function(){navigator.camera.getPicture(c,s,{quality:50,destinationType:Camera.DestinationType.DATA_URL,targetWidth:1e3,targetHeight:1e3})},e.deleteBill=function(t){e.pictures.splice(t,1)},e.submitBills=function(){n.show({template:"Bezig met versturen..."});var a={pictures:e.pictures};t({method:"POST",crossDomain:!0,data:$.param(a),url:serviceUrl+"addBill"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(t){e.pictures.length=0,n.hide(),r.show({title:"Rekening(en) uploaden voltooid",template:"Het uploaden van jouw rekening(en) is voltooid. Één van onze medewerkers zal je aangekochte producten analyseren en ze toevoegen aan je account.",buttons:[{text:"Sluiten",type:"bgGreen",onTap:function(t){e.$parent.$parent.billModal.hide()}}]})})}}).controller("EanCtrl",function(e,t,a,o,n,r,i,l){function c(t){setTimeout(function(){e.picture=t,e.$apply()},10)}function s(e){}"undefined"!=typeof analytics&&analytics.trackView("Submit EAN view"),e.picture=null,e.captureEan=function(){navigator.camera.getPicture(c,s,{quality:50,destinationType:Camera.DestinationType.DATA_URL,targetWidth:1e3,targetHeight:1e3})},e.deleteEan=function(t){e.picture=null},e.submitEan=function(){r.show({template:"Bezig met versturen..."});var o={picture:e.picture,store:e.retailer,ean:t.missingEan};console.log(o),a({method:"POST",crossDomain:!0,data:$.param(o),url:serviceUrl+"missingProduct"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(t){e.picture=null,e.retailer=null,r.hide(),i.show({title:"Foto uploaden voltooid",template:"Het uploaden van jouw foto is voltooid. Één van onze medewerkers zal de foto analyseren en het product proberen toe te voegen aan ons systeem.",buttons:[{text:"Sluiten",type:"bgGreen",onTap:function(t){e.$parent.$parent.eanModal.hide()}}]})})}}).controller("AccCtrl",function(e,t){e.toggleAccordion=function(a){e.activeAcc=e.isAccActive(a)?null:a,t.$getByHandle("scroll").resize()},e.isAccActive=function(t){return e.activeAcc===t}}).controller("TabsCtrl",function(e,t){e.currentTab=0,e.setTabActive=function(t){e.currentTab=t}});