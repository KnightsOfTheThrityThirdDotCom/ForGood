var serviceUrl="http://for-good.be/system/en/service/",sha=null;if(window.localStorage.user){var user=JSON.parse(window.localStorage.user);sha="/sha="+user.sha}angular.module("forgood.controllers",[]).controller("MainCtrl",function(e,o,t,a){var r=document.getElementsByClassName("pop-up"),n=r[0].getElementsByClassName("title"),c=r[0].getElementsByClassName("text");e.openPopup=function(e){console.log("test");var o=e.target.dataset.title,t=e.target.dataset.text;n[0].innerHTML=o,c[0].innerHTML=t,r[0].classList.remove("hidden")},e.closePopup=function(){r[0].classList.add("hidden")}}).controller("LogoutCtrl",function(e,o,t,a){a.nextViewOptions({disableBack:!0}),window.localStorage.clear(),t.go("login")}).controller("LoginCtrl",function(e,o,t,a,r){if(window.localStorage.user)var n=JSON.parse(window.localStorage.user);window.localStorage.user&&n.nulmeting?(console.log(n),t.go("progress"),a.nextViewOptions({disableBack:!0})):window.localStorage.user&&0===n.nulmeting&&(t.go("account-mobility"),a.nextViewOptions({disableBack:!0})),e.formData,e.processForm=function(){r.show({template:"Aanmelden..."}),o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"login",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){if(a.nextViewOptions({disableBack:!0}),1===e.success){r.hide(),sha="/sha="+e.user.sha;var o=JSON.stringify(e.user);window.localStorage.user=o,t.go(1===e.user.nulmeting?"progress":"account-mobility")}else r.hide(),alert("Gelieve in te loggen met de juiste gegevens.")})}}).controller("CreateAccountCtrl",function(e,o,t,a){e.formData,e.processForm=function(){o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"createProfile",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){if(a.nextViewOptions({disableBack:!0}),1===e.success){sha="/sha="+e.user.sha;var o=JSON.stringify(e.user);console.log(e.user.sha),window.localStorage.user=o,t.go("account-mobility")}else alert("Gelieve in te loggen met de juiste gegevens.")})}}).controller("ForgotPasswordCtrl",function(e,o,t,a){e.formData,e.processForm=function(){o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"forgotPassword",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){a.nextViewOptions({disableBack:!0}),1===e.success?(console.log(e),t.go("login")):(console.log(e),alert("Van dit e-mail adres bestaan geen gegevens."))})}}).controller("MobilityCtrl",function(e,o,t){e.formData={},e.formData.unitType="1",e.processForm=function(){console.log(e.formData),o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateMobilityProfile"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){t.go("account-energy")})}}).controller("EnergyCtrl",function(e,o,t){e.formData={electricityType:"2",yearlyConsumptionHeatingUnit:"2"},e.processForm=function(){console.log(e.formData),o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateEnergyProfile"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){console.log(e),t.go("account-monitor")})}}).controller("MonitorCtrl",function(e,o,t,a){e.formData={},e.processForm=function(){console.log(e.formData),o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateService"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){console.log(e),a.nextViewOptions({disableBack:!0}),t.go("progress")})}}).controller("ProgressCtrl",function(e,o,t,a){var r;e.init=function(){o({method:"POST",crossDomain:!0,data:e.formData,url:serviceUrl+"stats"+sha}).success(function(o){e.dataTotal=o,console.log(e.dataTotal);var t={chartTotal:[{value:o.TOTAL.circle.mobility_100,color:"#46acf1"},{value:o.TOTAL.circle.energy_100,color:"#eecc30"},{value:o.TOTAL.circle.consumption_100,color:"#f7395e"}],chartMobility:[{value:o.MOBILITY.circle.car_100,color:"#235679"},{value:o.MOBILITY.circle.public_100,color:"#388ac1"},{value:o.MOBILITY.circle.plane_100,color:"#46acf1"}],chartEnergy:[{value:o.ENERGY.circle.elec_100,color:"#776618"},{value:o.ENERGY.circle.heat_100,color:"#bea326"}],chartConsumption:[{value:o.CONSUMPTION.circle.package_100,color:"#7c1d2f"},{value:o.CONSUMPTION.circle.transport_100,color:"#c62e4b"},{value:o.CONSUMPTION.circle.storage_100,color:"#f7395e"},{value:o.CONSUMPTION.circle.season_100,color:"#fb9cae"},{value:o.CONSUMPTION.circle.ingredients_100,color:"#fdd7df"}]},a=document.getElementById("chart-total").getContext("2d"),r=document.getElementById("chart-mobility").getContext("2d"),n=document.getElementById("chart-energy").getContext("2d"),c=document.getElementById("chart-consumption").getContext("2d"),s={animation:!1,segmentStrokeWidth:1,percentageInnerCutout:65,segmentStrokeColor:"#f3efe7"};new Chart(a).Doughnut(t.chartTotal,s),new Chart(r).Doughnut(t.chartMobility,s),new Chart(n).Doughnut(t.chartEnergy,s),new Chart(c).Doughnut(t.chartConsumption,s),e.dataTotal.footprint_total=e.dataTotal.footprint_total.toFixed(1)})},e.init();var n=document.getElementById("swipe-position").getElementsByTagName("span"),c=document.getElementById("graphs").getElementsByClassName("cats");window.mySwipe=Swipe(document.getElementById("swipe"),{continuous:!1,callback:function(e){console.log(c);for(var o=n.length;o--;)n[o].className="off",c[o].classList.remove("on");n[e].className="on",c[e].classList.add("on")}}),e.scan=function(){console.log("test"),console.log(cordova),cordova.plugins.barcodeScanner.scan(function(e){console.log(e);var r={ean:e.text};o({method:"POST",crossDomain:!0,data:$.param(r),url:serviceUrl+"getProduct"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){a.submit(e),t.go("product")})},function(e){alert("Scanning failed: "+e)})}}).controller("UpdateCtrl",function(e,o,t,a){e.init=function(){o({method:"POST",crossDomain:!0,data:e.formData,url:serviceUrl+"getProfile"+sha}).success(function(o){e.currentValue=o.user})},e.init(),e.formData={},e.processForm=function(){console.log(e.formData),o({method:"POST",crossDomain:!0,data:$.param(e.formData),url:serviceUrl+"updateService"+sha,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){console.log(e),a.nextViewOptions({disableBack:!0}),t.go("progress")})}}).controller("ProductCtrl",function(e,o,t,a,r){e.init=function(){e.product=r.get(),console.log(e.product)},e.init()}).controller("AccCtrl",function(e){e.accordion=$(".accordion"),e.accordion.$accordionWrapper=e.accordion.find(".acc-wrapper"),e.accordion.$accordionWrapper.each(function(){var o=$(this);$(this)[0].isActive=!1,$accordionTitle=$(this).find(".acc-title"),$accordionTitle.on("click",function(){var t=$(this);e.openAccordion(t,o)})}),e.openAccordion=function(o,t){var a=t[0].isActive;e.accordion.$accordionWrapper.each(function(){$(this).removeClass("active"),$(this)[0].isActive=!1}),a?(t.removeClass("active"),t[0].isActive=!1):(t.addClass("active"),t[0].isActive=!0)}});